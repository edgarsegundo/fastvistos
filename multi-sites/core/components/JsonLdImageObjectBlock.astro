---
import { ensureTrailingSlash } from '../lib/utils.ts';
import { siteConfig } from '../../site-config.ts';

export function getImageObjectBlock({
    disableImageObject,
    imageId,
    image,
    imageUrl,
    caption,
    width,
    height,
}: {
    disableImageObject: boolean;
    imageId?: string | null;
    image?: string | null;
    imageUrl?: string;
    caption?: string;
    width?: number;
    height?: number;
}) {
    if (disableImageObject || (!imageUrl && !siteConfig.site?.image && !image)) return null;

    const assets_url_base = ensureTrailingSlash(siteConfig.assets_url_base);
    const url = image
        ? `${assets_url_base}${image.replace(/^.*\//, '')}`
        : imageUrl
          ? imageUrl
          : siteConfig.site?.image;
    return {
        '@type': 'ImageObject',
        inLanguage: siteConfig.site?.locate || 'br_BR',
        '@id': imageId ?? url, // Use imageId if not null/undefined, else use url
        url: url,
        contentUrl: url,
        ...(caption ? { caption } : {}),
        ...(width ? { width } : {}),
        ...(height ? { height } : {}),
    };
}
---

<section class="pt-4 pb-8">
  <div class="container mx-auto max-w-3xl px-4 flex flex-col items-center">
    <!-- Título principal -->
    <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900 text-center leading-tight mb-2">
      Propostas das melhores empresas
    </h1>
    <p class="text-lg text-gray-700 text-center mb-2">
      Seu emprego rápido, simples e direto do seu WhatsApp
    </p>
    <h2 class="text-2xl font-bold text-gray-900 text-center mb-2">Currículo IA Grátis</h2>

    <!-- CTA 1 -->
    <a href="#" class="mt-2 mb-4 inline-flex items-center justify-center px-8 py-3 bg-green-600 hover:bg-green-700 
    !text-white hover:!text-white visited:!text-white
    text-xl font-semibold rounded-full shadow transition-all duration-200">
      <img src="assets/images/logo/logo-mobile.png" class="h-auto" />
      Iniciar Currículo
    </a>

    <!-- Imagem 4:3 -->
    <div class="w-full max-w-2xl rounded-xl overflow-hidden mb-6 flex items-center justify-center bg-gray-100">
      <img src="assets/images/cover/video-mockup-whats-vagas.png" alt="Conversa WhatsApp" class="object-cover w-full h-full" loading="lazy" />
    </div>

    <!-- Bloco IA -->
    <div class="w-full bg-gray-50 rounded-2xl shadow p-6 flex flex-col items-center">
      <h3 class="text-xl md:text-2xl font-bold text-gray-900 text-center mb-2">
        Deixe nossa Inteligência artificial encontrar a vaga ideal pra você
      </h3>
      <p class="text-base text-gray-700 text-center mb-4">
        A IA <b>impulsiona</b> seu currículo para milhares de empresa e encontra vagas ideais conforme área, salário e localização.
      </p>
      <a href="#" class="inline-flex items-center justify-center px-8 py-3 bg-green-600 hover:bg-green-700 
      !text-white hover:!text-white visited:!text-white
      text-xl font-semibold rounded-full shadow transition-all duration-200">
        Procurar Vagas
      </a>
    </div>
  </div>
</section>

<!-- WAVE -->
<div class="relative -mt-12 lg:-mt-24 z-20">
  <svg viewBox="0 0 1428 174" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
      <g transform="translate(-2.000000, 44.000000)" fill="#FFFFFF" fill-rule="nonzero">
        <path d="M0,0 C90.7283404,0.927527913 147.912752,27.187927 291.910178,59.9119003 C387.908462,81.7278826 543.605069,89.334785 759,82.7326078 C469.336065,156.254352 216.336065,153.6679 0,74.9732496" opacity="0.100000001"></path>
        <path d="M100,104.708498 C277.413333,72.2345949 426.147877,52.5246657 546.203633,45.5787101 C666.259399,38.6327546 810.524845,41.7979068 979,55.0741668 C931.069965,56.122511 810.303266,74.8455141 616.699903,111.243176 C423.096539,147.640838 250.863238,145.462612 100,104.708498 Z" opacity="0.100000001"></path>
        <path d="M1046,51.6521276 C1130.83045,29.328812 1279.08318,17.607883 1439,40.1656806 L1439,120 C1271.17211,77.9435312 1140.17211,55.1609071 1046,51.6521276 Z" opacity="0.200000003"></path>
      </g>
      <g transform="translate(-4.000000, 76.000000)" fill="#FFFFFF" fill-rule="nonzero">
        <path d="M0.457,34.035 C57.086,53.198 98.208,65.809 123.822,71.865 C181.454,85.495 234.295,90.29 272.033,93.459 C311.355,96.759 396.635,95.801 461.025,91.663 C486.76,90.01 518.727,86.372 556.926,80.752 C595.747,74.596 622.372,70.008 636.799,66.991 C663.913,61.324 712.501,49.503 727.605,46.128 C780.47,34.317 818.839,22.532 856.324,15.904 C922.689,4.169 955.676,2.522 1011.185,0.432 C1060.705,1.477 1097.39,3.129 1121.236,5.387 C1161.703,9.219 1208.621,17.821 1235.4,22.304 C1285.855,30.748 1354.351,47.432 1440.886,72.354 L1441.191,104.352 L1.121,104.031 L0.457,34.035 Z"></path>
      </g>
    </g>
  </svg>
</div>

<script>
  // Aguarda o DOM estar pronto
  document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM carregado - inicializando hero section');
    
    // Handle search redirection from hero section
    const heroSearchInput = document.getElementById('hero-search-input') as HTMLInputElement;
    const heroSearchBtn = document.getElementById('hero-search-btn') as HTMLButtonElement;

    function redirectToSearch() {
      const searchTerm = heroSearchInput?.value.trim();
      if (searchTerm) {
        window.location.href = `/search/?q=${encodeURIComponent(searchTerm)}`;
      }
    }

    heroSearchBtn?.addEventListener('click', redirectToSearch);
    
    heroSearchInput?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        redirectToSearch();
      }
    });

    // Handle WhatsApp form submission
    const heroWhatsappForm = document.getElementById('hero-whatsapp-form') as HTMLFormElement;
    const heroDddInput = document.getElementById('hero-ddd') as HTMLInputElement;
    const heroWhatsappInput = document.getElementById('hero-whatsapp') as HTMLInputElement;
    
    console.log('Elementos encontrados:', {
      form: !!heroWhatsappForm,
      ddd: !!heroDddInput,
      whatsapp: !!heroWhatsappInput
    });

    // Validar e formatar apenas números no DDD
    if (heroDddInput) {
      heroDddInput.addEventListener('input', (e) => {
        const target = e.target as HTMLInputElement;
        target.value = target.value.replace(/\D/g, '');
      });
    }

    // Validar e formatar apenas números no WhatsApp
    if (heroWhatsappInput) {
      heroWhatsappInput.addEventListener('input', (e) => {
        const target = e.target as HTMLInputElement;
        let value = target.value.replace(/\D/g, '');
        
        // Formata: 98765-4321 ou 9876-5432
        if (value.length > 5) {
          if (value.length === 9) {
            value = value.replace(/(\d{5})(\d{4})/, '$1-$2');
          } else {
            value = value.replace(/(\d{4,5})(\d{0,4})/, '$1-$2');
          }
        }
        target.value = value;
      });
    }

    // Função para chamar API de onboarding
    async function startWhatsAppOnboarding(ddd: string, phone: string) {
    try {
      const url = 'https://emprego.p2digital.com.br/api/candidateprofile/start-whatsapp-onboarding/';
      const response = await fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ ddd, phone })
      });
      
      const data = await response.json();
      
      if (!response.ok) {
        // Tratar erros específicos
        if (data.error === 'required_fields') {
          throw new Error('Por favor, preencha DDD e WhatsApp.');
        } else if (data.error === 'invalid_phone') {
          throw new Error('Número de telefone inválido. Verifique DDD e número.');
        } else if (data.error === 'failed_create_post') {
          throw new Error('Erro ao criar perfil. Tente novamente.');
        } else if (data.error === 'internal_error') {
          throw new Error('Erro interno. Tente novamente mais tarde.');
        } else {
          throw new Error('Erro ao processar solicitação.');
        }
      }
      
      // Verificar resposta de sucesso
      if (!data.success) {
        throw new Error('Resposta inesperada do servidor.');
      }
      
      return data;
    } catch (error) {
      console.error('Erro ao iniciar onboarding:', error);
      throw error;
    }
    }

    // Enviar formulário WhatsApp
    if (heroWhatsappForm) {
      console.log('Adicionando event listener ao formulário WhatsApp');
      
      // Teste: adicionar click listener no botão também
      const submitBtn = heroWhatsappForm.querySelector('button[type="submit"]') as HTMLButtonElement;
      if (submitBtn) {
        console.log('Botão submit encontrado, adicionando click listener');
        submitBtn.addEventListener('click', (e) => {
          console.log('BOTÃO CLICADO!', e);
        });
      }
      
      heroWhatsappForm.addEventListener('submit', async (e) => {
        console.log('Formulário submetido!');
        e.preventDefault();
        
        const ddd = heroDddInput?.value.replace(/\D/g, '');
        const whatsapp = heroWhatsappInput?.value.replace(/\D/g, '');
        
        console.log('Valores capturados:', { ddd, whatsapp });
        
        if (!ddd || !whatsapp || ddd.length !== 2 || whatsapp.length < 8) {
          alert('Por favor, preencha DDD (2 dígitos) e WhatsApp (8-9 dígitos).');
          return;
        }
        
        const submitBtn = heroWhatsappForm.querySelector('button[type="submit"]') as HTMLButtonElement;
        if (!submitBtn) return;

        const originalText = submitBtn.innerHTML;

        try {
          // Desabilita botão e mostra loading
          submitBtn.disabled = true;
          submitBtn.innerHTML = '<span class="relative z-10">Enviando...</span>';

          // Chama API de onboarding
          await startWhatsAppOnboarding(ddd, whatsapp);

          // Sucesso - mostra feedback
          submitBtn.innerHTML = '<span class="relative z-10">✓ Enviado!</span>';
          alert('Cadastro realizado com sucesso! Em breve você receberá uma mensagem no WhatsApp para completar seu perfil.');

          // Aguarda 1 segundo e reseta formulário
          setTimeout(() => {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
            heroWhatsappForm.reset();
          }, 1000);

        } catch (error) {
          // Mostra erro
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalText;

          const errorMessage = error instanceof Error ? error.message : 'Erro ao processar solicitação.';
          alert(errorMessage);
        }
      });
    } else {
      console.error('Formulário hero-whatsapp-form não encontrado!');
    }
  });
</script>

<style>
.cta-button-wiggle {
    color: #ff6901;
    animation: wiggle 4s 2s infinite;
}

@keyframes wiggle {
    5%, 50% { transform: scale(1); }
    10% { transform: scale(0.9); }
    15% { transform: scale(1.15); }
    20% { transform: scale(1.15) rotate(-5deg); }
    25% { transform: scale(1.15) rotate(5deg); }
    30% { transform: scale(1.15) rotate(-3deg); }
    35% { transform: scale(1.15) rotate(2deg); }
    40% { transform: scale(1.15) rotate(0); }
}

/* Fade final da mulher */
.fade-mask {
  display: block;
  -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 80%, rgba(0,0,0,0) 100%);
  mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 80%, rgba(0,0,0,0) 100%);
  -webkit-mask-size: 100% 100%;
  mask-size: 100% 100%;
  -webkit-mask-repeat: no-repeat;
  mask-repeat: no-repeat;
  -webkit-mask-composite: source-over;
  mask-composite: add;
}

@supports not ((-webkit-mask-image: linear-gradient(to bottom, black, transparent))) {
  .fade-mask { position: relative; }
  .fade-mask::after {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 28%;
    pointer-events: none;
    background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%);
    border-radius: inherit;
  }
}
</style>


<style>
@keyframes spin-slow {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
.animate-spin-slow {
  animation: spin-slow 2s linear infinite;
}

.bullet-anim {
  width: 42px;
  height: 42px;
  min-width: 42px;
  border-radius: 9999px;
  background: linear-gradient(135deg, #22c55e, #38bdf8);
  color: white;
  font-weight: 800;
  font-size: 1.1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 6px 14px rgba(0,0,0,.25);
  animation: float 4s ease-in-out infinite;
}

.bullet-anim:nth-child(1) { animation-delay: 0s; }
.bullet-anim:nth-child(2) { animation-delay: .3s; }
.bullet-anim:nth-child(3) { animation-delay: .6s; }
.bullet-anim:nth-child(4) { animation-delay: .9s; }

@keyframes float {
  0%, 100% { transform: translateY(0) rotate(var(--tw-rotate)); }
  50% { transform: translateY(-4px) rotate(var(--tw-rotate)); }
}

</style>


<style>
/* Pulso suave para glow */
@keyframes pulse-slow {
  0%, 100% { opacity: 0.2; }
  50% { opacity: 0.6; }
}
.animate-pulse-slow {
  animation: pulse-slow 2s ease-in-out infinite;
}

/* Spin lento para borda */
@keyframes spin-slow {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
.animate-spin-slow {
  animation: spin-slow 4s linear infinite;
}
</style>


<style>
@keyframes slideUp {
  from { opacity: 0; transform: translate(-50%, 20px); }
  to { opacity: 1; transform: translate(-50%, 0); }
}
</style>

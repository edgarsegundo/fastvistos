---
import { siteConfig } from '../site-config.ts';

// Props:
// base: "article1"
// alt: texto
// class: classes extras
// breakpoints: [400, 608] (opcional)
const { base, alt, class: className = "", breakpoints = [400, 608] } = Astro.props;

console.log("[ResponsiveImage] base:", base);
console.log("[ResponsiveImage] alt:", alt);
console.log("[ResponsiveImage] class:", className);
console.log("[ResponsiveImage] breakpoints:", breakpoints);

// siteId do site-config
const siteId = siteConfig.site.id;
console.log("[ResponsiveImage] siteId:", siteId);

// Caminho base
const basePath = `/public-sites/${siteId}/assets/images-base/resized/${base}`;
console.log("[ResponsiveImage] basePath:", basePath);

// Gera srcset dinamicamente
function makeSrcSet(ext) {
  return breakpoints.map((bp: number) => `${basePath}-${bp}.${ext} ${bp}w`).join(', ');
}
---

<picture class={className}>
  <!-- WEBP -->
  <source
    type="image/webp"
    srcset={makeSrcSet('webp')}
    sizes={breakpoints.map(bp => `${bp}px`).join(', ')}
  />

  <!-- JPG fallback -->
  <source
    type="image/jpeg"
    srcset={makeSrcSet('jpg')}
    sizes={breakpoints.map(bp => `${bp}px`).join(', ')}
  />

  <!-- Fallback final -->
  <img
    src={`${basePath}-${breakpoints[breakpoints.length-1]}.jpg`}
    alt={alt}
    loading="lazy"
    decoding="async"
    class="w-full h-full object-cover"
  />
</picture>

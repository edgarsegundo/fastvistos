---
const {
  alt,
  width,
  height,
  sizes,
  sources = {},
  blurDataURL,
  priority = false,
  class: className = ""
} = Astro.props;

console.log("[ResponsiveImage] alt:", alt);
console.log("[ResponsiveImage] width:", width);
console.log("[ResponsiveImage] height:", height);
console.log("[ResponsiveImage] sizes:", sizes);
console.log("[ResponsiveImage] sources:", sources);
console.log("[ResponsiveImage] blurDataURL:", blurDataURL);
console.log("[ResponsiveImage] priority:", priority);
console.log("[ResponsiveImage] class:", className);

if (sources.webp) {
  console.log("[ResponsiveImage] <source> webp srcset:", sources.webp);
}
if (sources.jpeg) {
  console.log("[ResponsiveImage] <source> jpeg srcset:", sources.jpeg);
}
console.log("[ResponsiveImage] <img> fallback src:", blurDataURL);

// Fallback = blur (1 s√≥ vez, muito leve)
const fallbackSrc = blurDataURL;
---
<picture
  class={`relative block ${className}`}
  style={`background-image:url('${blurDataURL}'); background-size:cover; background-position:center;`}
>
  {sources.webp && (
    <source type="image/webp" srcset={sources.webp} sizes={sizes} />
  )}

  {sources.jpeg && (
    <source type="image/jpeg" srcset={sources.jpeg} sizes={sizes} />
  )}

  <img
    src={fallbackSrc}
    alt={alt}
    width={width}
    height={height}
    loading={priority ? "eager" : "lazy"}
    decoding="async"
    class="w-full h-full object-cover transition-opacity duration-300"
    style="opacity:0;"
    onload="this.style.opacity='1'"
  />
</picture>

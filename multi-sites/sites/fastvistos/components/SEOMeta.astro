---
// SEO Meta component that integrates with site-config
import OpenGraph from './OpenGraph.astro';
import TwitterCard from './TwitterCard.astro';
import type { SiteConfig } from '../lib/site-config.ts';

export interface Props {
    siteConfig: SiteConfig;
    title?: string;
    description?: string;
    pageUrl?: string;
    ogImage?: string;
    noIndex?: boolean;
    canonical?: string;
    enhancedIndexing?: boolean;  // Opt-in for rich snippets and prominent search results
    type?: 'website' | 'article' | 'book' | 'profile' | 
           'music.song' | 'music.album' | 'music.playlist' | 'music.radio_station' |
           'video.movie' | 'video.episode' | 'video.tv_show' | 'video.other' |
           'business.business' | 'place' | 'restaurant.menu' | 'restaurant.menu_item' | 
           'restaurant.menu_section' | 'restaurant.restaurant' |
           'product' | 'product.group' | 'product.item' |
           'game.achievement' | 'fitness.course';           // Content type (website, article, product, etc.)
    
    // OpenGraph article-specific properties
    author?: string;         // Author name for articles
    publishedTime?: string;  // ISO date string (e.g., "2024-01-15T10:00:00Z")
    modifiedTime?: string;   // ISO date string for last modification
    section?: string;        // Article section/category
    tags?: string[];         // Array of tags
}

const { 
    siteConfig,
    title,
    description,
    pageUrl,
    ogImage,
    noIndex = false,
    canonical,
    enhancedIndexing = false,
    type = 'website',
    author,
    publishedTime,
    modifiedTime,
    section,
    tags
} = Astro.props;

// Use page-specific values or fallback to site config
const metaDescription = description || siteConfig.seo.description;
const metaImage = ogImage || siteConfig.seo.ogImage;
const fullUrl = pageUrl || `https://${siteConfig.domain}`;
const canonicalUrl = canonical || fullUrl;

// Build complete image URL if it's a relative path
const fullImageUrl = metaImage.startsWith('http') 
    ? metaImage 
    : `https://${siteConfig.domain}${metaImage}`;
---

<!-- Basic SEO -->
<meta name="title" content={title || siteConfig.seo.title} />
<meta name="description" content={metaDescription} />
<meta name="keywords" content={siteConfig.seo.keywords.join(', ')} />
<meta name="author" content={author || siteConfig.seo.author} />

<link rel="canonical" href={canonicalUrl} />

{siteConfig.verification?.googleSiteVerification && (
    <meta name="google-site-verification" content={siteConfig.verification.googleSiteVerification} />
)}

{noIndex && <meta name="robots" content="noindex, nofollow" />}
<!-- Enhanced indexing: Enables rich snippets, large image previews, and extended text snippets in search results -->
{enhancedIndexing && !noIndex && (
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
)}

<!-- Language & Locale -->
<meta name="language" content={siteConfig.language} />
<html lang={siteConfig.language.split('-')[0]} />

<!-- Open Graph -->
<OpenGraph 
    title={siteConfig.seo.title}
    description={metaDescription}
    url={fullUrl}
    image={fullImageUrl}
    siteName={siteConfig.name}
    type={type}
    locale={siteConfig.language.replace('-', '_')}
    author={author}
    publishedTime={publishedTime}
    modifiedTime={modifiedTime}
    section={section}
    tags={tags}
/>

<!-- Twitter Card -->
<TwitterCard 
    title={metaTitle}
    description={metaDescription}
    image={fullImageUrl}
    url={fullUrl}
    site={siteConfig.socialMedia.twitter}
/>

<!-- Additional Meta -->
<meta name="theme-color" content={siteConfig.primaryColor} />
<meta name="msapplication-TileColor" content={siteConfig.primaryColor} />
